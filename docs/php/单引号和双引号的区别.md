# 单引号和双引号的区别

本文主要从工程实践和语言设计层面的角度，介绍单引号和双引号的区别。全文共计 1698 字，作者：凌枫。如果文章对你有帮助，请关注和转发，谢谢！

## 一、最主要区别

### 1、初步印象

当被问到单引号和双引号的区别，几乎本能反应都是，它们看起来都是一样的，难道真有什么区别？非要说有区别，难道就是语法习惯，最初我也是这样认为的。

### 2、最核心差异

单引号是“静态”的，双引号是“动态”的，一切差异均源于此。从 PHP 语言内部机制来看，则源于完全不同的编译和执行路径。在词法分析器识别过程中，单引号会被当做普通字符串值原样处理，双引号需要逐个扫描字符串，动态识别多种元素。

## 二、内部处理机制差异

我们接着从 PHP 语言特性，特别是其内部 Zend 引擎（Zend Engine）的角度来分析单引号和双引号字符串的处理机制。一般按执行顺序，会分为编译阶段和执行阶段。

### 1、编译阶段

在 PHP 代码运行时，首先会被 Zend Engine 的编译器转换成 Zend 操作码（OPCodes），这是 PHP 内部的一种中间代码。不管是单引号还是双引号编译后的操作码都会被 OPCache 缓存，因此在编译阶段的差异会被消除掉。单引号和双引号字符编译阶段对整体执行效率的影响不大。

单引号字符会被 Zend 引擎视为一个简单的常量字符串，简单地收集引号内的所有字符。词法分析器将其内容原样存储，几乎无需额外的处理。

双引号字符则会被 Zend 引擎识别为复杂的字符串，需要进行逐个扫描，词法分析器会识别片段为哪种元素，到底是普通字符、转义字符、变量标记，再采用不同的方式存储。所以双引号字符串最终不是作为一个整体存储，而是分解为一个包含多种类型 tokens 的序列。比如：字符串 "hello,$world\n"会被分解为，字符片段："hello,"、变量：$world、换行符片段。

### 2、执行阶段

在 PHP 代码在执行阶段，操作码都是由 Zend Executor 执行。单引号字符串的执行，简单地从常量池中取出字符串并输出，这是一个极其快速的内存查找操作，没有额外的计算开销。

双引号字符串的执行，需要按顺序计算序列的每一部分。字符串片段，可以直接使用；变量则需要进入当前符号表查找变量，这是一个哈希操作，比直接取常量更慢。再将所有内容连接成一个新字符串，这里会涉及到内存分配和字符串拷贝操作。最终输出拼接好的字符串整体。

双引号字符串在运行时需要进行变量查找、值获取和字符串拼接等步骤，这些步骤都需要消耗 CPU 周期和内存资源。而单引号字符串则可以省去这些步骤。

## 三、具体不同 case 最佳实践

### 1、实践共识

一般默认使用单引号。从性能层面上看，单引号性能优于双引号，原因是双引号需要额外的词法分析和运行时拼接开销，而在绝大多数应用场景下，性能差异几乎可忽略不计。选择原因不应将性能作为首要决策因素，代码的可读性和可维护性明显更重要。

### 2、单引号优先 case

从 PHP 内部机制看，可以清晰看到单引号字符串优势主要在运行时的查找和拼接开销，在现代 PHP 版本中，由于 Zend 引擎和 OPCache 的广泛应用，这种差异在绝大多数实际应用中变得微乎其微，执行中无法感知。唯一特例是在处理海量循环（如：百万次迭代）时，遵循“使用单引号除非你需要双引号的功能”这一原则仍然是最佳实践。

### 3、双引号优先case

想要动态拼接字符串，使用双引号是更佳选择。我们的考虑因素，主要是代码的可读性和可维护性。

```php
$message = 'key1:' . $value1 . ' key2:' . $value2 . ' key3:' . $value3 . '\n'; // 可读性稍差
$message = "key1:{$value1} key2:{$value2} key3:{$value3}\n"; // 可读性更佳
$message = spintf("key1:%s key2:%s key3:%s\n", $value1, $value2, $value2); // 可读性最佳，非本文讨论内容
```

## 四、总结概要

回顾全文，我们可以清晰地认识到，在 PHP 中单引号与双引号的选择，并非谁优谁劣。在现代 PHP 开发中，性能常常不是决策的主导因素，最佳实践是意图清晰，能够让代码阅读者秒懂：这里是一个无需变化的字符串，还是需要动态生成的字符串，这才是至关重要的。

如果文章对你有帮助，请关注和转发，谢谢！
![qr](../assets/qr.png)
